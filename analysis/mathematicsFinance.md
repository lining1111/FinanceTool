## 数理金融

    此文件对应同名的go文件

### 1 数学简介

    SumAP 等差数列的和 first 开始值 c个数 d 差值
    SumGP 等比数列的和 first 开始值 c个数 r 比率
    Factorial 阶乘 n
    Amn 排列
    Cmn 组合

    Max 最大值
    Min 最小值
    Avg 平均值
    Variance 方差
    StdDeviation 标准差
    Cov 协方差
    Corr 相关系数  如果corr为1,则完全正线性相关;如果corr为-1,则完全负线性相关;corr为0，则无有线性相关系数;
    corr大于-1小于0，则负相关，系数的程序反映了相关性的强弱;
    corr大于0小于1,则正相关，系数的程序反映了相关性的强弱;

### 2 货币时间价值

    pv cv r n 是货币时间的基本元素，求一个元素的值，必须知道除它外的其余元素的值 
    i = fv- cv
    PVInSingleRate 单利模式下现值计算 i 利息总和 r 利率 n 到期期限
    FVInSingleRate 单利模式下将来值计算 pv 现值 r 利率 n 到期期限
    ERInSingleRate 单利模式下实际利率计算 or 名义利率
    ORInSingleRate 单利模式下名义利率计算 er 实际利率
    
    PVInMulRate 复利模式下现值计算 fv 将来值 r 利率 n 到期期限
    FVInMulRate 复利模式下将来值计算 pv 现值 r 利率 n 到期期限
    DFInMulRate 复利模式下贴现因子计算 r 利率 n 到期期限
    CPInMulRate 复合期间，即由将来值fv、现值pv、利率r 计算需要多久才能使现值变将来值
    ERInMulRate 复利模式下，由名义利率r 变换期m计算有效利率r 当m无穷大时，er=e^r-1

### 3 债务和租赁

### 4 资本预算和折旧

    NetPresentValue NPV净现值 rate 利率 values 历史回报 i0初始投资
    IIR 内部回报率  使净现值为0的利率 values 历史回报 i0 初始投资
    PI 盈利指数 初始投资回报现值的比率，即流入现值和留出现值的比率
    Kvalue 资本化成本 c 原始成本 s 残值 r利率 m维修成本 n 使用年限
    具体的应用1
    假如我们有一台打印机，原始成本是65000美元，12年后估计残值为5000美元，机器生产率是每年20000本书，维护成本是3000美元，
    公司的工程师决定安装一个额外的配件，能够把机器的生产效率提高到每年30000本书，而不会影响到维护或使用寿命，如果投资率是8%
    那么公司能够接受多少钱达到提高生产率的目的
    c=65000 s=5000 n=12 m=3000 Kb=20000 Ka=30000 r=0.08
    这里前提是 花钱后，至少平均资本产出是相等的
    即 Kb/Pb=Ka/Pa 公式1
    技术改进前的Kb计算
    Kb = c+（c-s）/(（1+r）^n-1)+m/r 
    = 65000+((65000-5000)/((1+0.08)^12-1))+3000/0.08
    =65000+ 39521+ 37500=142021
    技术改进后的ka计算
    Ka=c+x+（c+x-s）/(（1+r）^n-1)+m/r
    =65000+x+(65000+x-5000)/((1+0.08)^12-1)+3000/0.08
    =65000+x+(60000+x)/1.518+37500
    =2.5x/1.5+142500
    =1.67x+142500
    通过公式1的到
    1.67x+142500=1.5*142021
    x=45402.18

### 5 盈亏平衡点和杠杆作用

    总成本C=固定成本FC+可变成本VC
    C=FC+VC
    因为可变成本是随着生产量变化的即VC=vQ Q产量 v单位成本
    所以C=FC+vQ
    收益R也依赖产品的销量即R=pQ p单位价格
    所以利润Pr=pQ-C=pQ-FC-vQ=(p-v)Q-FC
    当利润为0的时候，为盈亏平衡点即(p-v)Q-FC=0
    得到Q=FC/(p-v)
    即净利率*产量=固定成本
    BEQ 盈亏平衡产量 fc固定成本 p单位价格 v单位成本 BEQ=fc/(p-v)
    公式再变换后，
    BER 盈亏平衡收益 fc固定成本 p单位价格 v单位成本 BER=FC/(1-v/p)
    在数学上 CM 边际贡献 p单位价格 v单位成本 CM=p-v
    以上公式处理的问题就是决定生产量，运营的含义
    CBEQ 现金盈亏平衡产量 fc固定成本 nc任意非现金费用(可以是折旧费等) p单位价格 v单位成本 CBEQ=(fc-nc)/(p-v) 这里的含义就是初次的固定成本不一定一直重复支出
    
    C=FC+vQ和Q=qt得
    C=FC+vqt和利润R=pQ得
    R=pqt 加入时滞tl(从销售到回款)得
    R=pq(t-tl)  总耗时减去经营周期等于生产周期
    盈亏平衡的话，C=R，则
    FC+vqt=pq(t-tl)
    最终得到 t=(FC+pqtl)/q(p-v) 这里的含义就是时滞带来了产品收益的减少，即固定成本的增加
    BET 盈亏平衡时间 fc固定成本 p单位价格 v单位成本 q生产率(生产量除以时间) tl时滞(产品从销售出去拿到收益的时间) BET=(fc+p*q*tl)/(q*(p-v))

    借款情况下的盈亏平衡点
    生意启动之初，通过贷款或者借款完成融资生产，是一个合理的选择，这种情况下的盈亏平衡分析
    借款额度B 固定成本FC 单位成本v 生产效率q 时滞(单位商品出售到收到货款的时间)tl
    B=FC+v*q*tl     这里的含义是 生产的固定成本由固定成本和可变成本组成，这里可变成本是简单的由商品的单位成本*生产效率*时滞
    简单利率计算模式，总利息I 利率r 借款时间tb 利息等于借款额*利率*时间
    I=B*r*tb
    由上面两个公式的到 I=(FC+v*q*tl)*r*tb
    借款模式下，盈亏平衡点，即是利润=利息的时刻，这里的理解就是当到达这个时刻后，完成额外费用(即利息)的负担，
    之后的收益，可用于支付生产成本(即 原始借款)
    I=Pr    ---> I=R-C  R为收益    C为成本
    将上式各个元素代入   固定成本FC 单位成本v 生产率q 时滞tl 盈亏平衡时间t 收到贷款到开始生产时间t0 单位价格p
    (FC+v*q*tl)r(t+t0)=p*q*(t-tl)-(v*q*t+FC)
    将方程展开
    FC*t*r+FC*r*t0+v*q*tl*r*t+v*q*tl*r*t0=p*q*t-p*q*tl-v*q*t-FC
    t*FC*r+t*v*q*tl*r-p*q*t+v*q*t=-p*q*tl-FC-FC*r*t0-v*q*tl*r*t0
    t*(q*(p-v)-r*(FC+v*q*tl))=r*t0*(FC+v*q*tl)+FC+p*q*tl
    t=(r*t0*(FC+v*q*tl)+FC+p*q*tl)/(q*(p-v)-r*(FC+v*q*tl))
    应用示例
    生产手机的厂家，固定成本60000 每部手机15 每天生产200 每部卖50 生产开始到收益时间40  利率10%   生产前30天收到贷款
    贷款期限2年，计算盈亏平衡时间
    FC=60000 v=15 q=200 p=50 tl=40 r=0.1 t0=30 tb=2
    B=FC+q*v*tl=60000+200*15*40=180000
    则I=(FC+q*v*tl)*r*tb=180000*0.1*2=36000
    t=(r*t0*(FC+v*q*tl)+FC+p*q*tl)/(q*(p-v)-r*(FC+v*q*tl))
    =(0.1/365*30*180000+60000+200*50*40)/(200*(50-15)-0.1/365*180000)
    =(1480+460000)/(7000-49.3)
    =461480/6950=66.4
    盈亏平衡的简单应用
    股票买卖
    买入股票K股，每股买入价格yp，每股的佣金为ip;卖出的时候每股价格ys 佣金为is，如果保持盈亏的话，
    yp(1+ip)*K=ys(1-is)*K
    ys=yp*((1+ip/1-is))
    杠杆效应
    分为运营杠杆、财务杠杆、以及总杠杆
    运营杠杆程度DOL=Q(p-v)/(Q(p-v)-FC)    固定成本FC 产出Q 单位成本v 单位价格p 反映的是固定运营成本的潜在作用
    财务杠杆程序DFL，它度量每股收益EPS的变化相对于运营收入OY的变化
    总杠杆DCL=DOL*DFL
    这里的杠杆效应，可以从财务报告分析的杜邦分析法类比,股东权益报酬率（即净资产收益率）指标分解为销售净利率、资产周转率和权益乘数这三个指标的乘积
    股东权益报酬率=净利润/股东权益=(净利润*营业收入*资产)/(营业收入*资产*股东权益)=
                            销售净利润*资产周转率*权益乘数
    DCL=Q(p-v)/(Q(p-v)-FC-I-(Dps/(1-T))) 产量Q 单位价格p 单位成本v 固定成本FC 利息I 优先股分红Dps 税率T

### 6 投资
    股票-戈登公式
    P=D(1+g)/(r-g)  股票价值P 股息D 收益率r 股息增长率g